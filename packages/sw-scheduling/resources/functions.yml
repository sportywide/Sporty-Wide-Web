test:
    handler: src/lambda/test.handler
    events:
        - http:
              cors: true
              path: test
              method: get

fetch-teams:
    handler: src/lambda/crawl/fetch-teams.handler
    events:
        - http:
              cors: true
              path: teams
              method: get
        - schedule: cron(0 0 * * ? *)
    iamRoleStatements:
        - Effect: 'Allow'
          Action:
              - s3:putObject
          Resource: arn:aws:s3:::sw-data-bucket/*

fetch-players:
    handler: src/lambda/crawl/fetch-players.handler
    events:
        - sns: arn:aws:sns:ap-southeast-2:409050499179:fifa-team-topic
    iamRoleStatements:
        - Effect: 'Allow'
          Action:
              - s3:putObject
          Resource: arn:aws:s3:::sw-data-bucket/*

fetch-fixtures:
    handler: src/lambda/crawl/fetch-fixture.handler
    events:
        - sns: arn:aws:sns:ap-southeast-2:409050499179:fifa-team-topic
    iamRoleStatements:
        - Effect: 'Allow'
          Action:
              - s3:putObject
          Resource: arn:aws:s3:::sw-data-bucket/*

fetch-league-result:
    handler: src/lambda/crawl/fetch-league-result.handler
    events:
        - sqs:
              arn:
                  Fn::GetAtt: [ScoreboardTeamQueue, Arn]
    iamRoleStatements:
        - Effect: 'Allow'
          Action:
              - s3:putObject
          Resource: arn:aws:s3:::sw-data-bucket/*
    layers:
        - arn:aws:lambda:ap-southeast-2:409050499179:layer:puppeteer:1

save-teams:
    handler: src/lambda/persist/save-teams.handler
    events:
        - s3:
              bucket: sw-data-bucket
              event: s3:ObjectCreated:*
              rules:
                  - prefix: teams/fifa/
                  - suffix: .json
              existing: true
    iamRoleStatements:
        - Effect: 'Allow'
          Action:
              - sns:*
          Resource: arn:aws:sns:${self:provider.region}:${self:custom.aws.accountId}:fifa-team-topic
        - Effect: 'Allow'
          Action:
              - s3:getObject
          Resource: arn:aws:s3:::sw-data-bucket/*

save-players:
    handler: src/lambda/persist/save-players.handler
    events:
        - s3:
              bucket: sw-data-bucket
              event: s3:ObjectCreated:*
              rules:
                  - prefix: players/fifa/
                  - suffix: .json
              existing: true
    iamRoleStatements:
        - Effect: 'Allow'
          Action:
              - s3:getObject
          Resource: arn:aws:s3:::sw-data-bucket/*

save-fixtures:
    handler: src/lambda/persist/save-fixture.handler
    events:
        - s3:
              bucket: sw-data-bucket
              event: s3:ObjectCreated:*
              rules:
                  - prefix: fixtures
                  - suffix: .json
              existing: true
    iamRoleStatements:
        - Effect: 'Allow'
          Action:
              - s3:getObject
          Resource: arn:aws:s3:::sw-data-bucket/*

save-league-result:
    handler: src/lambda/persist/save-league-result.handler
    events:
        - s3:
              bucket: sw-data-bucket
              event: s3:ObjectCreated:*
              rules:
                  - prefix: teams/scoreboard
                  - suffix: .json
              existing: true
    iamRoleStatements:
        - Effect: 'Allow'
          Action:
              - s3:getObject
          Resource: arn:aws:s3:::sw-data-bucket/*
fetch-scoreboard:
    handler: src/lambda/crawl/fetch-scoreboard-cron.handler
    events:
        - schedule:
              rate: rate(15 minutes)
